---
kind: CliInputPrompt
version: v1
metadata:
  name: url
  skipDeleteAll: true
spec:
  promptText: 'Enter URL of file to download:'
  promptCharacter: 'URL > '
---
kind: CliInputPrompt
version: v1
metadata:
  name: save-target
spec:
  promptText: 'Enter the full path where the downloaded file must be saved, including the filename:'
  promptCharacter: 'Target Output File > '
---
kind: WebDownloadFile
version: v1
metadata:
  name: web-download
  dependencies:
    apply:
    - url
    - save-target
  skipDeleteAll: true
spec:
  sourceUrl: !Variable 'CliInputPrompt:url:default:CLI_INPUT_VALUE'
  targetOutputFile: !Variable 'CliInputPrompt:save-target:default:CLI_INPUT_VALUE'
---
kind: WriteFile
version: v1
metadata:
  name: write-file-v1-minimal
  dependencies:
    apply:
    - web-download
spec:
  data: !Sub
  - '{"status": "${status}","downloadPath": "${path}"}'
  - status: !Variable 'CliInputPrompt:web-download:default:STATUS'
    path: !Variable 'CliInputPrompt:save-target:default:CLI_INPUT_VALUE'
  targetFile: /tmp/results.json
---
kind: ShellScript
version: v1
metadata:
  name: cleanup
  dependencies:
    delete:
    - save-target
  skipApplyAll: true
spec:
  source:
    type: inline
    value: !Sub
    - 'rm -vf ${file}'
    - file: !Variable 'CliInputPrompt:save-target:default:CLI_INPUT_VALUE'
  convertOutputToText: true
  stripNewline: True
  convertRepeatingSpaces: true
  stripLeadingTrailingSpaces: true
